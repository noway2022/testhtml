const body=jQuery("body"),ri={init:function(){ri.lazyLoading(),ri.backTotop(),ri.offCanvas(),ri.stickyHeader(),ri.stickyBar(),ri.pagination(),ri.owlCarousel(),ri.gallerylight(),ri.CodeHighlight(),ri.add_post_views(),ri.social_action(),ri.add_comment(),ri.setIframeHeight(),ri.PostBuyWidget(),ri.pay_action(),ri.changeOrder(),ri.account_action()},intervalId:null,currentPopup:null,ajax:function({data:e,before:n=()=>{},result:t=()=>{},complete:o=()=>{}}){jQuery.ajax({url:zb.ajax_url,data:e,type:"post",dataType:"json",async:!0,success:t,error:function(e){ri.notice(e.responseText,500)},beforeSend:n,complete:o})},notice:function(e="",n=220,t=2e3){let o=jQuery(".ri-notice");!e&&o.length?o.clearQueue().stop().hide():(!o.length&&e&&(o=jQuery(`<div class="ri-notice" style="min-width: ${n}px"></div>`),body.append(o)),o.clearQueue().stop().hide().html(e).fadeIn().delay(t).fadeOut())},popup:function(e,n=240,t=null){const o=jQuery(`<div class="ri-popup"><div class="ri-popup-body" ${n?`style="width:500px"`:""}><div class="ri-popup-close"><span class="svg-close"></span></div><div class="ri-popup-content">${e}</div></div></div>`),i=(ri.currentPopup&&ri.currentPopup.remove(),ri.currentPopup=o,()=>{body.removeClass("ri-popup-open"),ri.dimmer("close",100),o.remove()});e?(body.removeClass("ri-popup-open").append(o),ri.notice(!1),setTimeout(()=>{body.addClass("ri-popup-open"),ri.dimmer("open",100)},10),o.on("click touchstart",".ri-popup-close .svg-close, .dimmer",e=>{e.preventDefault(),(t||i)(),i()})):i()},dimmer:function(e,n=300){var t=jQuery(".dimmer");switch(e){case"open":t.fadeIn(n);break;case"close":t.fadeOut(n)}},backTotop:function(){let e;const n=jQuery(".back-top");n.length&&(window.addEventListener("scroll",function(){400<=(e=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop)?n.addClass("back-top-show"):n.removeClass("back-top-show")}),n.on("click",function(e){e.preventDefault(),jQuery("html, body").animate({scrollTop:0},"smooth")}))},offCanvas:function(){var e=jQuery(".burger"),n=jQuery(".canvas-close"),t=jQuery(".dimmer"),o={label:"",prependTo:".mobile-menu",closedSymbol:'<i class="fas fa-angle-down">',openedSymbol:'<i class="fas fa-angle-up">'},i=body.hasClass("uc-page")?".uc-menu-warp":".main-menu .nav-list";jQuery(i).slicknav(o),e.on("click",function(){body.toggleClass("canvas-opened"),body.addClass("canvas-visible"),ri.dimmer("open")}),n.on("click",function(){body.hasClass("canvas-opened")&&(body.removeClass("canvas-opened"),ri.dimmer("close"))}),t.on("click",function(){body.hasClass("canvas-opened")&&(body.removeClass("canvas-opened"),ri.dimmer("close"))}),jQuery(document).keyup(function(e){27==e.keyCode&&body.hasClass("canvas-opened")&&(body.removeClass("canvas-opened"),ri.dimmer("close"))})},stickyHeader:function(){const o=jQuery(".site-header");if(o.length){const i=o.outerHeight();let t=0;document.addEventListener("scroll",function(e){var n=window.pageYOffset||document.documentElement.scrollTop;n>i?(o.addClass("navbar-now"),n<t&&(o.addClass("navbar-sticky"),o.removeClass("navbar-now"))):(o.removeClass("navbar-now"),0===n&&o.removeClass("navbar-sticky")),t=n})}var e=jQuery(".site-header .nav-list"),n=window.location.href;e.find("li").removeClass("current-menu-item"),e.find(`a[href="${n}"]`).closest("li").addClass("current-menu-item")},stickyBar:function(){var e=jQuery("[data-sticky]");e.length&&e.theiaStickySidebar({updateSidebarHeight:!1,additionalMarginTop:30})},lazyLoading:function(){0<jQuery(".lazy").length&&(window.lazyLoadInstance=new LazyLoad({}))},setIframeHeight:function(){var e=jQuery(".post-content");const t=e.width();Array.from(e.find("iframe")).forEach(function(e){var n=9*t/16;jQuery(e).css({height:n,width:"100%"})})},PostBuyWidget:function(){var e=jQuery(".post-pay-widget"),n=e.find(".prices_warp").data("resize"),t=jQuery(".post-content");new ClipboardJS(".copy-pwd",{text:function(e){return e.getAttribute("data-pwd")}}).on("success",function(e){ri.notice("密码已复制剪贴板")}),jQuery(window).width()<992&&("top"===n?e.prependTo(t):e.appendTo(t)),body.on("click",".unlock-pay-btn",function(){const e=jQuery(".post-pay-widget");let n=e.offset().top;var t=jQuery(".site-header");t.length&&(n-=t.outerHeight()),jQuery("html, body").animate({scrollTop:n},200,function(){e.addClass("highlighted",500),setTimeout(function(){e.removeClass("highlighted"),jQuery(".site-header").addClass("navbar-now")},500)})})},CodeHighlight:function(){0!=zb.singular_id&&(hljs.addPlugin({"after:highlightElement":({el:e,result:n,text:t})=>{e.dataset.language=n.language;e.insertAdjacentHTML("afterbegin",'<div class="hljs-block-header"><span class="hljs-block-copy">复制</span></div>'.trim());const o=e.querySelector(".hljs-block-copy"),i=o.innerText;new ClipboardJS(o,{text:function(){return t}}).on("success",function(e){o.innerText="复制成功",setTimeout(function(){o.innerText=i},1e3)})}}),document.querySelectorAll(".post-content pre").forEach(e=>{e.classList.contains("highlighted")||(e.classList.add("highlighted"),e.innerHTML=e.innerHTML.trim(),hljs.highlightElement(e))}))},owlCarousel:function(){const n={autoplay:!1,loop:!1,items:1,margin:10,lazyLoad:!1,nav:!0,dots:!0,navText:['<i class="fa fa-angle-left"></i>','<i class="fa fa-angle-right"></i>'],navElement:"div"};var e=jQuery(".owl-carousel");e.length&&e.each(function(){var e=jQuery(this).data("config")||{},e=$.extend({},n,e);jQuery(this).owlCarousel(e)})},pagination:function(){var e=jQuery(".posts-warp");const o=jQuery(".infinite-scroll-button"),i=jQuery(".infinite-scroll-status"),a=jQuery(".infinite-scroll-msg");var n=o.hasClass("infinite-click"),t=(o.hasClass("infinite-auto"),{append:".posts-warp > *",debug:!1,hideNav:".pagination",history:!1,path:".pagination a.page-next",prefill:!0});o.length&&(n&&(t.button=".infinite-scroll-button",t.prefill=!1,t.scrollThreshold=!1),e.on("request.infiniteScroll",function(e,n){i.show()}),e.on("load.infiniteScroll",function(e,n,t){i.hide()}),e.on("append.infiniteScroll",function(e,n,t,o,i){window.lazyLoadInstance.update()}),e.on("last.infiniteScroll",function(e,n,t){o.hide(),a.show()}),e.infiniteScroll(t))},add_post_views:function(){0!=zb.singular_id&&jQuery.post(zb.ajax_url,{action:"zb_add_post_views",nonce:zb.ajax_nonce,post_id:zb.singular_id})},gallerylight:function(){var e=jQuery(".post-content");e.length&&(e=e.find('a[href$=".jpg"], a[href$=".jpeg"], a[href$=".png"], a[href$=".gif"]')).length&&e.click(function(e){e.preventDefault();var n,e=jQuery(this).closest(".gallery");e.length?(n=(e=e.find(".gallery-item")).index(jQuery(this).closest(".gallery-item"))+1,e=e.map(function(){return{title:jQuery(this).find(".gallery-caption").text(),src:jQuery(this).find("a").attr("href")}}).get(),Spotlight.show(e,{index:n})):Spotlight.show(jQuery(this))})},social_action:function(){const e=jQuery(".post-fav-btn"),t=jQuery(".post-like-btn"),n=jQuery(".post-share-btn"),o="post_like_storage";t.on("click",function(){if(localStorage.getItem(o)==zb.singular_id)return t.addClass("disabled"),ri.notice(t.data("text")),!1;ri.ajax({data:{action:"zb_add_like_post",nonce:zb.ajax_nonce,post_id:zb.singular_id},before:()=>t.addClass("disabled"),result:({status:e,msg:n})=>{1==e?localStorage.setItem(o,zb.singular_id):(t.removeClass("disabled"),localStorage.removeItem(o)),ri.notice(n)}})}),e.on("click",function(){ri.ajax({data:{action:"zb_add_fav_post",nonce:zb.ajax_nonce,is_add:e.data("is"),post_id:zb.singular_id},before:()=>e.addClass("disabled"),result:({msg:e})=>ri.notice(e)})}),n.on("click",function(){ri.ajax({data:{action:"zb_add_share_post",nonce:zb.ajax_nonce,post_id:zb.singular_id},before:()=>n.addClass("disabled"),result:({msg:e})=>{ri.popup(e)},complete:()=>n.removeClass("disabled")})})},add_comment:function(){const o=jQuery("#commentform");o.find('input[type="submit"]'),o.submit(function(e){e.preventDefault();const n=jQuery("#submit"),t=n.val();jQuery.ajax({type:"POST",url:zb.ajax_url,data:o.serialize()+"&action=zb_ajax_comment&nonce="+zb.ajax_nonce,beforeSend:function(e){n.prop("disabled",!0).val("提交中...")},error:function(e,n,t){ri.notice(e.responseText)},success:function(e){"success"==e?(n.val("评论成功"),ri.notice("评论成功，即将刷新页面"),setTimeout(function(){window.location.reload()},2e3)):ri.notice(e)},complete:function(e){n.prop("disabled",!1).val(t)}})});var e=jQuery(".comments-list");const i=jQuery(".infinite-scroll-button"),a=jQuery(".infinite-scroll-status"),r=jQuery(".infinite-scroll-msg");i.length&&(e.on("request.infiniteScroll",function(e,n){a.show()}),e.on("load.infiniteScroll",function(e,n,t){a.hide()}),e.on("last.infiniteScroll",function(e,n,t){i.hide(),r.show()}),e.infiniteScroll({append:".comments-list > *",debug:!1,hideNav:".comments-pagination",history:!1,path:".comments-pagination a.next",prefill:!1,scrollThreshold:!1,button:".infinite-scroll-button"}))},account_action:function(){const t=jQuery("#captcha-img"),e=jQuery("input[name='captcha_code']"),n=jQuery("#account-from"),i=jQuery("#click-submit");t.on("click",function(){ri.ajax({data:{action:"zb_get_captcha_img",nonce:zb.ajax_nonce},before:()=>{},result:({status:e,msg:n})=>{1==e?t.attr("src",n):ri.notice(n)},complete:()=>{e.val("")}})}),i.on("click",function(e){e.preventDefault();e=n.serializeArray();let o=decodeURIComponent(location.href.split("redirect_to=")[1]||"");e={nonce:zb.ajax_nonce,...Object.fromEntries(e.map(({name:e,value:n})=>[e,n]))};ri.ajax({data:e,before:()=>{i.prop("disabled",!0)},result:({status:e,msg:n,back_url:t})=>{ri.notice(n),1==e&&setTimeout(()=>{(o=window.frames.length!==parent.frames.length?"":o)?window.location.href=o:t?window.location.href=t:window.location.reload()},2e3)},complete:()=>{t.attr("src",t.attr("data-src")),i.prop("disabled",!1)}})})},pay_action:function(){var e=jQuery(".js-pay-action");let n=null;e.on("click",function(){var e=jQuery(this);n={nonce:zb.ajax_nonce,action:"zb_get_pay_action",pay_type_id:0,post_id:e.data("id"),order_type:e.data("type"),order_info:e.data("info")},ri.get_pay_select_html()}),body.on("click",".pay-item:not([data-is='1'])",function(){const e=jQuery(this);n.pay_type_id=e.data("id"),ri.ajax({data:n,before:()=>{e.data("is","1"),ri.notice("请求支付中···")},result:e=>{1==e.status?(ri.notice(!1),ri.pay_result_callback(e),ri.changeOrder(5e3,!1)):ri.notice(e.msg)}})})},get_pay_select_html:function(){ri.ajax({data:{action:"zb_get_pay_select_html",nonce:zb.ajax_nonce},result:({status:e,msg:n})=>{1==e?ri.popup(n,240):ri.notice(n)}})},order_num_cookie(e="remove"){var n="_zb_current_order_num",t=window.location.host;return"remove"===e?jQuery.removeCookie(n,{domain:t,path:"/"}):jQuery.cookie(n)},pay_result_callback:function(e){if(0==e.status)return ri.notice(e.msg),!1;"popup"==e.method?ri.popup(e.msg,280,()=>{ri.notice("已取消支付"),clearInterval(ri.intervalId),ri.order_num_cookie("remove")}):"url"==e.method&&(window.location.href=e.msg)},changeOrder:function(e=5e3,n=!0){clearInterval(ri.intervalId);var t=ri.order_num_cookie("get");if(!t)return!1;const o=e=>{ri.ajax({data:{action:"zb_check_pay_status",nonce:zb.ajax_nonce,num:e},result:({status:e,msg:n,back_url:t})=>{1==e&&(clearInterval(ri.intervalId),ri.order_num_cookie("remove"),ri.notice(n),ri.popup(!1),setTimeout(()=>window.location.href=t,2e3))}})};n&&o(t),ri.intervalId=setInterval(()=>{var e=jQuery.cookie("_zb_current_order_num");return e?(o(e),!0):(clearInterval(ri.intervalId),!1)},e)}};jQuery(function(e){ri.init(),e(window).resize(function(){}),console.group(window.location.host+" --\x3e main.js"),console.log("%c 性能","color:orange; font-weight: bold",e("#debug-info").text()),console.groupEnd()});